<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‡ªå»ºèŒ§æˆ¿ Â· è¶‹åŠ¿æ´å¯Ÿé¢æ¿</title>
  <link rel="icon" href="./img/trend-icon.png" />
  <style>
    body {
      font-family: "Inter", "PingFang SC", "Microsoft Yahei", sans-serif;
      margin: 0;
      background: #f5f7fa;
      color: #1f2d3d;
    }
    header {
      background: url("https://picx.zhimg.com/v2-53929aa63157aa2c5ff6fb2ecc22094b_r.jpg") center/cover no-repeat;
      color: white;
      text-align: center;
      padding: 100px 20px 140px;
      position: relative;
    }
    header::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 80px;
      background: linear-gradient(to bottom, rgba(245,247,250,0) 0%, #f5f7fa 100%);
    }
    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
    }
    h2 {
      font-size: 1rem;
      font-weight: 400;
      opacity: 0.85;
    }
    main {
      max-width: 1200px;
      margin: -80px auto 0;
      display: flex;
      gap: 20px;
      padding: 0 20px 60px;
    }
    section {
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 20px;
      flex: 1;
    }
    section h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #2563eb;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .item {
      padding: 8px 0;
      border-bottom: 1px solid #f0f2f5;
    }
    .item:last-child {
      border: none;
    }
    .item a {
      text-decoration: none;
      color: #1f2d3d;
      font-weight: 500;
    }
    .item a:hover {
      color: #2563eb;
    }
    .meta {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 4px;
    }
    .chip {
      display: inline-block;
      background: #f1f5f9;
      border-radius: 12px;
      padding: 4px 10px;
      font-size: 0.85rem;
      color: #374151;
      margin: 4px 4px 0 0;
    }
    footer {
      text-align: center;
      color: #9ca3af;
      font-size: 0.85rem;
      padding-bottom: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>è‡ªå»ºèŒ§æˆ¿ Â· è¶‹åŠ¿æ´å¯Ÿé¢æ¿</h1>
    <h2>æ²‰æ·€æ€è€ƒ Â· å®ˆæŠ¤ä¸“æ³¨ Â· è‡ªåŠ¨è¿½è¸ªå…¨çƒä¿¡æ¯è„‰ç»œ</h2>
  </header>

  <main>
    <section>
      <h3>ğŸ“Œ ä»Šæ—¥é‡ç‚¹è¶‹åŠ¿</h3>
      <div id="trends">åŠ è½½ä¸­...</div>
    </section>

    <section>
      <h3>ğŸ”¥ çƒ­æœå…³é”®è¯</h3>
      <div id="keywords">åŠ è½½ä¸­...</div>
    </section>
  </main>

  <footer>Â© 2025 è‡ªå»ºèŒ§æˆ¿ | æ•°æ®æºï¼šåå°”è¡—è§é—» Â· æ–°æµªè´¢ç» Â· ç™¾åº¦æŒ‡æ•°</footer>

  <script>
    async function loadTrends() {
      const elTrends = document.getElementById("trends");
      const elKeywords = document.getElementById("keywords");
      try {
        const res = await fetch("/api/trends.json?v=" + Date.now());
        if (!res.ok) throw new Error("fetch failed");
        const data = await res.json();
        if (!data.topics || data.topics.length === 0) {
          elTrends.innerHTML = "<p>æš‚æ— æ•°æ®<br>æ£€æŸ¥ /api/trends.json</p>";
          elKeywords.innerHTML = "<span class='chip'>æš‚æ— å…³é”®è¯</span>";
          return;
        }

        // æ¸²æŸ“è¶‹åŠ¿åˆ—è¡¨
        elTrends.innerHTML = data.topics
          .slice(0, 15)
          .map(
            (t) => `
              <div class="item">
                <a href="${t.links[0].url}" target="_blank">${t.title}</a>
                <div class="meta">
                  æ¥æºï¼š${t.sources.join("ã€")} ï½œ å¹³å°æ•°ï¼š${t.cover} ï½œ çƒ­åº¦åˆ†ï¼š${t.score.toFixed(2)}
                </div>
              </div>`
          )
          .join("");

        // æå–å…³é”®è¯ï¼ˆç®€å•ï¼šæ‹†åˆ†è‹±æ–‡å•è¯å‡ºç°é¢‘æ¬¡ï¼‰
        const allTitles = data.topics.map(t => t.title).join(" ");
        const words = allTitles
          .toLowerCase()
          .replace(/[^a-z\u4e00-\u9fa5\s]/g, "")
          .split(/\s+/)
          .filter(w => w.length > 2);
        const freq = {};
        words.forEach(w => freq[w] = (freq[w] || 0) + 1);
        const topK = Object.entries(freq)
          .sort((a,b) => b[1]-a[1])
          .slice(0, 12);
        elKeywords.innerHTML = topK.length
          ? topK.map(([w]) => `<span class="chip">${w}</span>`).join("")
          : "<span class='chip'>æš‚æ— å…³é”®è¯</span>";
      } catch (err) {
        elTrends.innerHTML = "<p>åŠ è½½å¤±è´¥ï¼š" + err + "</p>";
        elKeywords.innerHTML = "<span class='chip'>æš‚æ— å…³é”®è¯</span>";
      }
    }

    loadTrends();
  </script>
</body>
</html>
