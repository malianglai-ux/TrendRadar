<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>自建茧房 · 趋势洞察面板</title>
<link rel="icon" href="./img/trend-icon.png" />
<style>
body { font-family: "Inter","PingFang SC","Microsoft Yahei", sans-serif; margin:0; background:#f5f7fa; color:#1f2d3d; }
header { background: url("https://picx.zhimg.com/v2-53929aa63157aa2c5ff6fb2ecc22094b_r.jpg") center/cover no-repeat; color:white; text-align:center; padding:140px 20px 160px; position:relative; }
header::after { content:""; position:absolute; left:0; right:0; bottom:0; height:120px; background:linear-gradient(to bottom, rgba(245,247,250,0) 0%, #f5f7fa 100%); }
h1 { font-size:2.4rem; margin:0; text-shadow:0 2px 6px rgba(0,0,0,0.25); }
h2 { font-size:1rem; margin-top:8px; opacity:0.9; text-shadow:0 1px 3px rgba(0,0,0,0.3); }
main { max-width:1300px; margin:-100px auto 0; display:grid; grid-template-columns:1fr 1fr; gap:20px; padding:0 20px 80px; position:relative; z-index:3; }
section { background:white; border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,0.05); padding:20px; min-height:400px; }
section h3 { font-size:1.1rem; font-weight:600; color:#2563eb; margin-top:0; }
.item { padding:8px 0; border-bottom:1px solid #f0f2f5; }
.item:last-child { border:none; }
.item a { text-decoration:none; color:#1f2d3d; font-weight:500; }
.item a:hover { color:#2563eb; }
.meta { font-size:0.85rem; color:#6b7280; margin-top:4px; }
footer { text-align:center; color:#9ca3af; font-size:0.85rem; padding-bottom:20px; }
</style>
</head>
<body>
<header>
<h1>自建茧房 · 趋势洞察面板</h1>
<h2>沉淡思考 · 守护专注 · 自动追踪全球信息脉线</h2>
</header>
<main>
<section>
<h3>中文趋势热榜</h3>
<div id="zh-trends">加载中...</div>
</section>
<section>
<h3>英文趋势热榜</h3>
<div id="en-trends">加载中...</div>
</section>
<section style="grid-column: span 2;">
<h3>聚类主题榜（中英合并）</h3>
<div id="clusters">加载中...</div>
</section>
</main>
<footer>© 2025 自建茧房 | 数据源：知乎 · 微博 · 百度 · 头来 · Google · Reuters · Yahoo</footer>
<script>
async function loadTrends() {
  const zhEl = document.getElementById("zh-trends");
  const enEl = document.getElementById("en-trends");
  const clusterEl = document.getElementById("clusters");
  try {
    const res = await fetch("api/trends.json?v=" + Date.now());
    if (!res.ok) throw new Error("fetch failed");
    const data = await res.json();
    const topics = Array.isArray(data.topics) ? data.topics : [];
    // separate Chinese and English topics
    const zh = topics.filter(item => /[\u4e00-\u9fa5]/.test(item.title || ""));
    const en = topics.filter(item => !/[\u4e00-\u9fa5]/.test(item.title || ""));
    // calculate max scores for percent scale
    const maxScoreZh = zh.reduce((max, item) => Math.max(max, item.score || 0), 0);
    const maxScoreEn = en.reduce((max, item) => Math.max(max, item.score || 0), 0);
    function renderList(list, maxScore) {
      return list.map(item => {
        const link = (item.links && item.links.length > 0) ? item.links[0] : "#";
        const title = item.title || item.topic || "无标题";
        const percent = maxScore > 0 ? Math.round(((item.score || 0) / maxScore) * 100) : 0;
        return `<div class="item"><a href="${link}" target="_blank">${title}</a><div class="meta">热度：${percent}%</div></div>`;
      }).join("");
    }
    // sort by score descending and slice top 15
    const zhList = zh.sort((a,b) => (b.score || 0) - (a.score || 0)).slice(0, 15);
    const enList = en.sort((a,b) => (b.score || 0) - (a.score || 0)).slice(0, 15);
    zhEl.innerHTML = zhList.length ? renderList(zhList, maxScoreZh) : "<p>暂无中文数据</p>";
    enEl.innerHTML = enList.length ? renderList(enList, maxScoreEn) : "<p>暂无英文数据</p>";
    // cluster topics by cluster identifier
    const clusterMap = {};
    topics.forEach(item => {
      const key = item.cluster || item.topic || item.title;
      if (!clusterMap[key]) {
        clusterMap[key] = { title: key, items: [], score: 0 };
      }
      clusterMap[key].items.push(item);
      clusterMap[key].score += item.score || 0;
    });
    const clusterList = Object.values(clusterMap).sort((a,b) => b.score - a.score).slice(0, 15);
    const maxClusterScore = clusterList.length ? clusterList[0].score : 0;
    const clusterHtml = clusterList.map(c => {
      const percent = maxClusterScore > 0 ? Math.round((c.score / maxClusterScore) * 100) : 0;
      const first = c.items[0] || {};
      const link = (first.links && first.links.length > 0) ? first.links[0] : "#";
      return `<div class="item"><a href="${link}" target="_blank">${c.title}</a><div class="meta">热度：${percent}%</div></div>`;
    }).join("");
    clusterEl.innerHTML = clusterList.length ? clusterHtml : "<p>暂无聚类结果</p>";
  } catch (err) {
    zhEl.innerHTML = "<p>加载失败</p>";
    enEl.innerHTML = "<p>加载失败</p>";
    clusterEl.innerHTML = "<p>加载失败</p>";
  }
}
loadTrends();
</script>
</body>
</html>
