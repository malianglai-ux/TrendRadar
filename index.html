<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è‡ªå»ºèŒ§æˆ¿ Â· è¶‹åŠ¿æ´å¯Ÿé¢æ¿</title>
  <meta name="description" content="è‡ªå»ºèŒ§æˆ¿ï¼šè‡ªåŠ¨è¿½è¸ªå…¨çƒä¿¡æ¯è„‰ç»œï¼Œèšåˆä¸­è‹±æ–‡è¶‹åŠ¿ï¼ŒæŒ‰é‡åˆåº¦è®¡ç®—çƒ­åº¦ï¼Œå¹¶æ ‡æ³¨æ¥æºã€‚" />
  <link rel="icon" href="./img/trend-icon.png" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --text:#0f172a; --muted:#64748b; --brand:#2563eb;
      --chip:#eef2ff; --chipText:#334155; --ok:#fb923c; --border:#e5e7eb; --shadow:0 8px 30px rgba(2,6,23,.06)
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,-apple-system,"PingFang SC","Microsoft YaHei",Segoe UI,Roboto,Ubuntu}
    a{color:inherit;text-decoration:none}
    .hero{
      height:320px; background:url('https://picx.zhimg.com/v2-53929aa63157aa2c5ff6fb2ecc22094b_r.jpg') center/cover no-repeat;
      position:relative; display:flex; align-items:flex-end; justify-content:center;
    }
    .hero::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(to bottom,rgba(15,23,42,.35) 0%,rgba(15,23,42,.25) 40%, rgba(246,248,251,1) 100%);
    }
    .hero-inner{
      position:relative; z-index:1; width:100%; max-width:1080px; padding:24px;
      color:#fff; transform:translateY(8px);
    }
    .title{font-weight:800; letter-spacing:.02em; font-size:28px}
    .subtitle{opacity:.95; margin-top:6px}

    .wrap{max-width:1080px;margin:-48px auto 40px;padding:0 20px;position:relative}
    .grid{display:grid;grid-template-columns:1.7fr .9fr;gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .card h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--border);font-size:15px}
    .list{padding:8px}
    .item{display:flex;align-items:flex-start;gap:10px;padding:12px;border-radius:12px;border:1px solid transparent}
    .item + .item{margin-top:6px}
    .item:hover{background:#fafbff;border-color:#eef2ff}
    .rank{width:26px;height:26px;border-radius:8px;background:#eff6ff;color:#1d4ed8;display:grid;place-items:center;font-weight:700}
    .main{flex:1 1 auto;min-width:0}
    .t{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .meta{margin-top:4px;color:var(--muted);font-size:12px;display:flex;gap:10px;align-items:center}
    .src{background:var(--chip);color:var(--chipText);padding:2px 8px;border-radius:999px;font-size:12px}
    .heat{margin-left:auto;color:#c2410c;background:#fff7ed;border:1px solid #fed7aa;padding:2px 8px;border-radius:999px;font-weight:700}
    .badge{font-size:12px;color:#334155;background:#e2e8f0;border-radius:999px;padding:2px 8px}
    .aside{padding:10px}
    .tag{display:inline-block;margin:6px 6px 0 0;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:12px}
    .footer{margin:24px 0;color:var(--muted);text-align:center;font-size:12px}
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <section class="hero">
    <div class="hero-inner">
      <div class="title">è‡ªå»ºèŒ§æˆ¿ Â· è¶‹åŠ¿æ´å¯Ÿé¢æ¿</div>
      <div class="subtitle">æ²‰æ·€æ€è€ƒ Â· å®ˆæŠ¤ä¸“æ³¨ Â· è‡ªåŠ¨è¿½è¸ªå…¨çƒä¿¡æ¯è„‰ç»œ</div>
    </div>
  </section>

  <main class="wrap">
    <div class="grid">
      <!-- å·¦ï¼šè¶‹åŠ¿åˆ—è¡¨ï¼ˆæŒ‰çƒ­åº¦ï¼‰ -->
      <section class="card">
        <h3>ğŸ“ˆ æœ€æ–°è¶‹åŠ¿ï¼ˆæŒ‰çƒ­åº¦ï¼‰</h3>
        <div id="list" class="list"></div>
      </section>

      <!-- å³ï¼šå…³é”®è¯ä¸ç»Ÿè®¡ -->
      <aside class="card">
        <h3>ğŸ”¥ çƒ­æœå…³é”®è¯</h3>
        <div id="tags" class="aside"></div>
        <div class="aside" style="border-top:1px solid var(--border);margin-top:8px;padding-top:12px">
          <span class="badge" id="meta-count">â€”</span>
          <span class="badge" id="meta-gen">â€”</span>
        </div>
      </aside>
    </div>
    <div class="footer">Â© 2025 è‡ªå»ºèŒ§æˆ¿ Â· æ•°æ®æ¥è‡ªå¤šæºèšåˆ Â· æŒ‰è·¨æºé‡åˆåº¦è®¡ç®—çƒ­åº¦å¹¶æ ‡æ³¨æ¥æº</div>
  </main>

  <script>
    const API = './api/trends.json?v=' + Date.now(); // å¼ºåˆ¶ç»•è¿‡ç¼“å­˜

    // åˆ†è¯­è¨€èšåˆï¼šè¿”å› { zh:[], en:[] }
    function splitLang(topics){
      const zh=[], en=[];
      for(const t of topics){
        const any = t.links && t.links[0]?.title || t.title || '';
        /[\u4e00-\u9fa5]/.test(any) ? zh.push(t) : en.push(t);
      }
      return { zh, en };
    }

    function renderList(container, items){
      container.innerHTML = '';
      items.forEach((t, idx)=>{
        const first = t.links?.[0] || {};
        const url = first.url || '#';
        const source = first.source || (t.sources?.[0] || 'â€”');
        const title = first.title || t.title || '(æ— æ ‡é¢˜)';
        const heat = (t.heat ?? 0).toFixed ? t.heat.toFixed(0) : t.heat;

        const el = document.createElement('a');
        el.className='item';
        el.href = url;
        el.target = '_blank';
        el.rel='noopener noreferrer';
        el.innerHTML = `
          <div class="rank">${idx+1}</div>
          <div class="main">
            <div class="t">${title}</div>
            <div class="meta">
              <span class="src">æ¥æºï¼š${source}</span>
            </div>
          </div>
          <div class="heat">çƒ­åº¦ï¼š${heat ?? 0}</div>
        `;
        container.appendChild(el);
      });
    }

    function renderTags(container, items){
      container.innerHTML='';
      // å–æ ‡é¢˜å…³é”®è¯ç²—ç•¥åˆ‡è¯
      const words = {};
      items.forEach(t=>{
        const title = (t.links?.[0]?.title || t.title || '').toLowerCase();
        const arr = title.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]+/g,' ').split(/\s+/).filter(x=>x && x.length>=2);
        arr.forEach(w=>{ words[w]=(words[w]||0)+1; });
      });
      const top = Object.entries(words).sort((a,b)=>b[1]-a[1]).slice(0,20);
      top.forEach(([w,c])=>{
        const span = document.createElement('span');
        span.className='tag';
        span.textContent = `${w} Â· ${c}`;
        container.appendChild(span);
      });
    }

    fetch(API).then(r=>r.json()).then(data=>{
      const topics = (data?.topics || []).map(t=>{
        // å…¼å®¹å­—æ®µï¼šèšåˆå™¨å·²å†™å…¥ heatï¼›è‹¥æ²¡æœ‰åˆ™å›é€€ size
        t.heat = t.heat ?? Math.round((t.size || 1) * 10);
        return t;
      });
      const { zh, en } = splitLang(topics);

      // ä¼˜å…ˆæ˜¾ç¤ºâ€œå…¨éƒ¨â€æŒ‰çƒ­åº¦æ’åº
      const all = [...topics].sort((a,b)=> (b.heat??0)-(a.heat??0));
      renderList(document.getElementById('list'), all);
      renderTags(document.getElementById('tags'), all);

      // é¡µè„šç»Ÿè®¡
      document.getElementById('meta-count').textContent = `ä¸»é¢˜æ•°ï¼š${data?.topic_count ?? topics.length}`;
      document.getElementById('meta-gen').textContent   = `ç”Ÿæˆï¼š${data?.generated_at ?? 'â€”'}`;
    }).catch(e=>{
      const box = document.getElementById('list');
      box.innerHTML = `<div style="padding:16px;color:#ef4444">åŠ è½½å¤±è´¥ï¼š${e?.message||e}</div>`;
    });
  </script>
</body>
</html>
